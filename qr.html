<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>패스오더 QR 페이지</title>
</head>

<body class="bg-white">
  <div id="app"></div>

  <script>
    const params = new URLSearchParams(location.search);
    const uid = params.get("uid") || "unknown";
    const variant = params.get("variant") || "A";

    // 사장님 설문 페이지 주소 (GitHub Pages)
    const targetUrl = "https://paytalab-m.github.io/B2B-test_moon/survey.html";
    const scanUrl = `${targetUrl}?uid=${uid}&variant=${variant}`;

    /* ★ 핵심 수정 사항 ★ 
       파일 주소 뒤에 `?t=${Date.now()}`를 붙였습니다.
       이렇게 하면 브라우저가 "어? 새로운 주소네?" 하고 
       강제로 서버에서 최신 파일을 다시 받아옵니다. (캐시 무시)
    */
    fetch(`./layouts/layout${variant}.html?t=${Date.now()}`)
      .then(res => {
         if (!res.ok) throw new Error("파일을 찾을 수 없습니다.");
         return res.text();
      })
      .then(html => {
        // QR 코드 이미지 주소 생성
        const qrImgSrc = `https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${encodeURIComponent(scanUrl)}`;

        // HTML 치환
        html = html.replaceAll("{{QR_SRC}}", qrImgSrc);
        html = html.replaceAll("{{UID}}", uid);
        html = html.replaceAll("{{VARIANT}}", variant);

        document.getElementById("app").innerHTML = html;
      })
      .catch(err => {
        console.error(err);
        document.getElementById("app").innerHTML = `<div class='p-10 text-center'>화면을 불러오는 중 오류가 발생했습니다.<br>(${err.message})</div>`;
      });
  </script>
</body>
</html>
